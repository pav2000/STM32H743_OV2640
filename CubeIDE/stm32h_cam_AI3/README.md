Пример 3 X-CUBE.AI для CubeMX IDE.<br>
Пакет X-CUBE-AI расширяет функциональные возможности среды STM32CubeMX, добавляя в нее автоматический генератор библиотеки
нейронной сети. Этот генератор преобразует файлы моделей предварительно обученных нейронных сетей, формируемые различными
фреймворками глубокого обучения (такими как Caffe, Keras, Lasagne, TensorFlow™ Lite и ConvNetJs), в оптимизированную по
скорости выполнения и объему памяти (ОЗУ и Flash) библиотеку. Сгенерированная библиотека автоматически интегрируется с
пользовательским приложением, в результате чего на выходе получается полностью настроенный проект, готовый к компиляции и
исполнению на микроконтроллере STM32.<br>
Пакет расширения X-CUBE-AI предназначен для создания проектов с поддержкой ИИ на базе микроконтроллеров STM32
с ядрами ARM® Cortex®-M.Текущая версия примера использует:<br>
- X-CUBE-AI версии 8.0.0; <br>
- клиентское API нейронной сети версии 1.2.0;<br>
- утилита командной строки версии 1.7.0.<br>
Предварительно обученная DL-модель Keras, используется в данном примере.<br>
<br>
Третий пример использования X-CUBE.AI.
Используется нейросеть обученная на распознавание 10 классов (dataset CIFAR10).<br>
Набор данных CIFAR-10 состоит из 60000 32×32 затеняющих изображений в 10 классах, по 6000 изображений для каждого класса.
Набор данных разделен на пять подготавливающих кусков и одну тестовую группу, каждая из которых содержит 10000 фотографий.
Тестовая группа содержит ровно 1000 беспорядочно выбранных снимков для каждого класса. Кластеры подготовки содержат остальные
картинки в произвольных запросах, однако некоторые группы подготовки могут содержать больше картинок из одного класса, чем из
другого. Между ними группы подготовки содержат ровно 5000 картинок из каждого класса.<br>
Классы в наборе  CIFAR10 <br>
- самолет<br>
- автомобиль<br>
- птица<br>
- кошка<br>
- олень<br>
- собака<br>
- лягушка<br>
- лошадь<br>
- корабль<br>
- грузовик<br>
Насколько мне известно на данный момент есть статьи в которых заявляется решение задачи классификации на данном датасете с
точностью выше 99.0% (см., например, [A. Kolesnikov, L. Beyer, X. Zhai, J. Puigcerver, J. Yung, S. Gelly, N. Houlsby
“Big Transfer (BiT): General Visual Representation Learning”, arXiv:1912.11370v3, 2019] в которой заявлена точность 99.37%).
Но я задачи собрать сеть, которая бы достигла “state of the arts” перед собой в данном случае не ставил. Интересен был на
самом деле не абсолютный результат, а относительные изменения при добавлении и удалении разных компонент.
Нейросеть имеет на входе картинку 32х32х3, где первые два числа ширина и выстота обрабатываемого изображения,
3 это RGB компоненты цвета. Камера выдает картинку 160х160 пикселей и при формировании входного массива нейросети
используется прореживание точек (берется каждая пятая точка по вертикали и горизонтали) или усреднение массива точек 5х5.<br>
<br>
Кнопка SELECT - ставит процесс распознавания на паузу. Кнопка ENTER включает/отключает усреднение точек по маске 5х5 точек, если
эта опция не включена то работает прореживание - берется каждая пятая точка на изображении.<br>
Слева экрана выводится все классы с определенными вероятностями.<br>
Внизу экрана выводится частота обновления кадров.<br>
<br>
Важно!<br>
Мною было замечено, что при изменении в Cube.MX параметров нейрости (возможно еще чего?), происходит спонтанное переключение на
тактирование от внутренней RC цепочки и сброс внешнего кварца на 8 МГц. Необходимо проверять в Cube.MX - использование внешнего
кварца и установка его частоты на 25 МГц. В противном случае пример не будет работать. Также после новой генерации кода
необходимо закоментировать вызовы MX_X_CUBE_AI_Process() и MX_X_CUBE_AI_Init() (это шаблон X-CUBE.AI), в примере им написаны альтернативы.
<br>
Создание нейросети с входами 32х32 точек.<br>
<img src="https://github.com/pav2000/STM32H743_OV2640/blob/main/CubeIDE/stm32h_cam_AI3/picture/neuro1.jpg" width="640" /> <br>
Использование X-CUBE.AI (используемая память)<br>
<img src="https://github.com/pav2000/STM32H743_OV2640/blob/main/CubeIDE/stm32h_cam_AI3/picture/neuro2.jpg" width="480" /> <br>
Результат распозования получился не очень, особенно животных. Включение усреднения улучшает но не намного результаты.
Особенно хорошо распознаются - самолет, автомобиль, грузовик.<br>
Результаты работы на целевом устройстве - пример распознования некоторых классов.<br>
<img src="https://github.com/pav2000/STM32H743_OV2640/blob/main/CubeIDE/stm32h_cam_AI3/picture/automobile.jpg" width="320" /> <br>
<img src="https://github.com/pav2000/STM32H743_OV2640/blob/main/CubeIDE/stm32h_cam_AI3/picture/airplane.jpg" width="320" /> <br>
<img src="https://github.com/pav2000/STM32H743_OV2640/blob/main/CubeIDE/stm32h_cam_AI3/picture/ship.jpg" width="320" /> <br>
<img src="https://github.com/pav2000/STM32H743_OV2640/blob/main/CubeIDE/stm32h_cam_AI3/picture/horse.jpg" width="320" /> <br>
<br>
<br>

